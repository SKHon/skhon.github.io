---
title: 项目代码没动过，之前好使，现在报错了？
date: 2020-05-14 15:00:00
categories: 前端
tags: [node]
comments: true
copyright: true
---

## 背景

昨天晚上，有个业务方过来问，之前hobber项目跑的好好的，下午部署怎么报错了？看git提交记录，也没动过代码呀。
然后我就帮他查，最后定位到require一个依赖库的时候，报错了。那为什么代码没动过，之前部署没问题，现在就不行了呢？
<!--more-->

## 分析
首先，我们项目代码没动过，之前好使，现在不好使，基本可以说明，我们项目的业务代码是没问题的，那么，哪些地方会出问题呢？
我们先分析一下我开始说的案例，我回头看了一下他们项目的git仓库，发现缺少一个文件：package-lock.json。这个是破案的关键，因为package-lock.json是锁定依赖版本的，那么项目重新部署时，项目是没有package-lock.json的，那在npm install的时候，会拉一下依赖版本的最新小版本，如果某个依赖，刚刚发了一个小版本，但是这个小版本可能会影响你的项目，一旦这中小概率时间命中了你的项目，那就出现了上述提到的问题。我的项目代码明明没动过，为什么重新部署的时候，就会报错。

## 怎么解决
知道问题的原因，就比较容易找解决方案了。找到之前项目没问题时候的package-lock.json文件，把这个文件拷贝过来替换到有问题的项目中，把node_modules删掉，重新npm install 一下，基本就ok了。所以，大家要注意，在提交代码的时候，package-lock.json也应该被提交。
